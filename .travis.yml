language: java

env:
- BUILD_TYPE=""
- BUILD_TYPE="-DdevBuild"
- BUILD_TYPE="" ADDED_LIBS="-Dkakadu.version=${KAKADU_VERSION}"
- BUILD_TYPE="-DdevBuild" ADDED_LIBS="-Dkakadu.version=${KAKADU_VERSION}"

services:
- docker

before_install:
- >-
  openssl aes-256-cbc -K $encrypted_3fc12ce230ac_key -iv $encrypted_3fc12ce230ac_iv
  -in src/test/resources/kakadu_github_key.enc -out kakadu_github_key -d
- chmod 600 kakadu_github_key
- eval $(ssh-agent -s)
- ssh-add kakadu_github_key

install: true

script: >-
      travis_retry mvn deploy $BUILD_TYPE $ADDED_LIBS
      -Ddocker.registry.username="${DOCKER_USERNAME}"
      -Ddocker.registry.password="${DOCKER_PASSWORD}"
      -Ddocker.registry.account="${DOCKER_REGISTRY_ACCOUNT}"
      -Dorg.slf4j.simpleLogger.log.net.sourceforge.pmd=error

# We want all PRs built, but only merges on the 'main' branch
branches:
  only:
  - main

notifications:
  email:
    recipients:
      - ksclarke@ksclarke.io
    on_success: change
    on_failure: change

#
# Things one needs to set in their project's online Travis configuration
#
# DOCKER_PASSWORD - For logging into the Docker registery (e.g., DockerHub)
# DOCKER_USERNAME - For logging into the Docker registery (e.g., DockerHub)
# DOCKER_REGISTRY_ACCOUNT - For deploying Docker images to the registry
# AUTH_TOKEN - For querying GitHub releases (otherwise, it's rate limited)
# REG_USERNAME - The DockerHub user or organization that owns the project
# REG_PROJECT - The DockerHub project to which the tagged image is being pushed
# JENKINS_USER - User used to connect to our Jenkins instance
# JENKINS_USER_PASS - Password used to connect to our Jenkins instance
# JENKINS_URL: - Token used to connect to our Jenkins instance
#
